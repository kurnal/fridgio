<!doctype html>
<html>
    <head>
      <title>Inventory</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css">
      <link rel="stylesheet" href="./index.css">
      <link rel="stylesheet" href="../../bootstrap-table-master/dist/bootstrap-table.min.css">
      <link href="../../fontawesome/css/all.css" rel="stylesheet">
      <script type = "text/javascript" src="../../bootstrap/js/jquery-3.6.0.min.js"></script>
      <script type = "text/javascript" src="../../bootstrap/js/bootstrap.bundle.min.js"></script>
      <script type = "text/javascript" src="../../bootstrap-table-master/dist/bootstrap-table.min.js"></script>
      
      <script>
        function update() {
            // init if localStorage variable does not exist
            let curr = window.localStorage.getItem('INVENTORY')
            if (curr == null) {
                window.localStorage.setItem('INVENTORY', JSON.stringify({ items: [] }))
            } else {
                $("#food tbody tr").remove() 
                let inventory = JSON.parse(curr)
                inventory.items.forEach(el => {
                  $("#food tbody").append("<tr>" +
                  "<td>" + el['name'] + "</td>" +
                  "<td>" + el['qty'] + "</td>" +
                  "<td>" + el['expdate'] + "</td>" +
                  "<td>" + el['category'] + "</td>" +
                  "<td onclick=\"del(this, '" + el['name'] + "');\"><i class='fas fa-trash'></i></td>" + 
                  "</tr>");
                  })
            }
          }
    </script>
    <script>

        $(document).ready(function () {
          $('#demolist a').on('click', function () {
            $('#dropdownMenuLink').html($(this).text() + ' <span class="caret"></span>');
            $('#dropdownMenuLink').val($(this).data('value'));
          });
        });

        function sort_order() {

          let curr = window.localStorage.getItem('INVENTORY')
            if (curr == null) {
                window.localStorage.setItem('INVENTORY', JSON.stringify({ items: [] }))
            }
          
          let inventory = JSON.parse(window.localStorage.getItem('INVENTORY'))

          order = window.localStorage.getItem('CATEGORY'); 

            if (order == 1) {
              inventory['items'] = 
                inventory.items.filter(function(el) {
                  console.log(el)
                  if (el.category.includes('Proteins')) {
                    return true
                  }
                  return false
                }).concat(inventory.items.filter(function(el) {
                  if (el.category.includes('Proteins')) {
                    return false
                  }
                  return true
                }))
            }

            if (order == 2) {
              inventory['items'] = 
                inventory.items.filter(function(el) {
                  console.log(el)
                  if (el.category.includes('Vegetables')) {
                    return true
                  }
                  return false
                }).concat(inventory.items.filter(function(el) {
                  if (el.category.includes('Vegetables')) {
                    return false
                  }
                  return true
                }))
            }

            if (order == 3) {
              inventory['items'] = 
                inventory.items.filter(function(el) {
                  console.log(el)
                  if (el.category.includes('Fruits')) {
                    return true
                  }
                  return false
                }).concat(inventory.items.filter(function(el) {
                  if (el.category.includes('Fruits')) {
                    return false
                  }
                  return true
                }))
            }

            if (order == 4) {
              inventory['items'] = 
                inventory.items.filter(function(el) {
                  console.log(el)
                  if (el.category.includes('Grains')) {
                    return true
                  }
                  return false
                }).concat(inventory.items.filter(function(el) {
                  if (el.category.includes('Grains')) {
                    return false
                  }
                  return true
                }))
            }

            str_inventory = JSON.stringify(inventory)
          
            window.localStorage.setItem('INVENTORY', str_inventory)

            update(); 
        }

        function sort_table_alphabet() { 
          let curr = window.localStorage.getItem('INVENTORY')
            if (curr == null) {
                window.localStorage.setItem('INVENTORY', JSON.stringify({ items: [] }))
            }
          
          let inventory = JSON.parse(window.localStorage.getItem('INVENTORY'))
          
          inventory['items'] = inventory.items.sort(function(a,b){
            var nameA = a.name.toUpperCase(); // ignore upper and lowercase
            var nameB = b.name.toUpperCase(); // ignore upper and lowercase
            if (nameA < nameB) {
              return -1;
            }
            if (nameA > nameB) {
              return 1;
            }

            // names must be equal
            return 0;
          }); 

          console.log(inventory)
          
          str_inventory = JSON.stringify(inventory)
          
          window.localStorage.setItem('INVENTORY', str_inventory)

          update();  
        }

        function sort_table_rev() { 
          let curr = window.localStorage.getItem('INVENTORY')
            if (curr == null) {
                window.localStorage.setItem('INVENTORY', JSON.stringify({ items: [] }))
            }
          
          let inventory = JSON.parse(window.localStorage.getItem('INVENTORY'))
          
          inventory['items'] = inventory.items.sort(function(a,b){
            var nameA = a.name.toUpperCase(); // ignore upper and lowercase
            var nameB = b.name.toUpperCase(); // ignore upper and lowercase
            if (nameA < nameB) {
              return 1;
            }
            if (nameA > nameB) {
              return -1;
            }

            // names must be equal
            return 0;
          }); 

          console.log(inventory)
          
          str_inventory = JSON.stringify(inventory)
          
          window.localStorage.setItem('INVENTORY', str_inventory)

          update();  
        }

        function sort_by_date_latest() {
          let curr = window.localStorage.getItem('INVENTORY')
            if (curr == null) {
                window.localStorage.setItem('INVENTORY', JSON.stringify({ items: [] }))
            }
          
          let inventory = JSON.parse(window.localStorage.getItem('INVENTORY'))

          inventory['items'] = inventory.items.sort(function(a,b){
            return new Date(b.expdate) - new Date(a.expdate);
          }); 

          console.log(inventory)
          
          str_inventory = JSON.stringify(inventory)
          
          window.localStorage.setItem('INVENTORY', str_inventory)

          update();  
        }

        function sort_by_date_soonest() {
          let curr = window.localStorage.getItem('INVENTORY')
            if (curr == null) {
                window.localStorage.setItem('INVENTORY', JSON.stringify({ items: [] }))
            }
          
          let inventory = JSON.parse(window.localStorage.getItem('INVENTORY'))

          inventory['items'] = inventory.items.sort(function(a,b){
            return new Date(a.expdate) - new Date(b.expdate);
          }); 

          console.log(inventory)
          
          str_inventory = JSON.stringify(inventory)
          
          window.localStorage.setItem('INVENTORY', str_inventory)

          update();  
        }

        function sort_by_qty_low() {
          let curr = window.localStorage.getItem('INVENTORY')
            if (curr == null) {
                window.localStorage.setItem('INVENTORY', JSON.stringify({ items: [] }))
            }
          
          let inventory = JSON.parse(window.localStorage.getItem('INVENTORY'))

          inventory['items'] = inventory.items.sort(function(a,b){
            a = a.qty.replace(/[^0-9]/g, '')
            b = b.qty.replace(/[^0-9]/g, '')
            return a-b
          }); 

          console.log(inventory)
          
          str_inventory = JSON.stringify(inventory)
          
          window.localStorage.setItem('INVENTORY', str_inventory)

          update();  
        }

        function sort_by_qty_high() {
          let curr = window.localStorage.getItem('INVENTORY')
            if (curr == null) {
                window.localStorage.setItem('INVENTORY', JSON.stringify({ items: [] }))
            }
          
          let inventory = JSON.parse(window.localStorage.getItem('INVENTORY'))

          inventory['items'] = inventory.items.sort(function(a,b){
            a = a.qty.replace(/[^0-9]/g, '')
            b = b.qty.replace(/[^0-9]/g, '')
            return b-a
          }); 

          console.log(inventory)
          
          str_inventory = JSON.stringify(inventory)
          
          window.localStorage.setItem('INVENTORY', str_inventory)

          update();  
        }


        function add() {
            // init if localStorage variable does not exist
            let curr = window.localStorage.getItem('INVENTORY')
            if (curr == null) {
                window.localStorage.setItem('INVENTORY', JSON.stringify({ items: [] }))
            }
            
            let inventory = JSON.parse(window.localStorage.getItem('INVENTORY'))

            item = document.getElementById("item").value
            qty = document.getElementById("qty").value
            expdate = document.getElementById("expdate").value
            category = document.getElementById("dropdownMenuLink").text



            entry = {}
            entry["name"] = item
            entry["qty"] = qty
            entry["expdate"] = expdate
            entry['category'] = category 
            
            console.log(inventory)

            if (!(entry in inventory['items'])) {
              inventory['items'].push(entry)
            }

            str_inventory = JSON.stringify(inventory)
            window.localStorage.setItem('INVENTORY', str_inventory)
        }

        function openGroceryList(uuid) {
            window.location.href = "./grocery-list.html" + `?uuid=${uuid}`; 
        }

        function del(o, name) { 
          let inventory = JSON.parse(window.localStorage.getItem('INVENTORY'))
          
          o.parentNode.remove() 

          inventory['items'] = inventory.items.filter(el => {
              return (el['name'] != name)
          })
          
          str_inventory = JSON.stringify(inventory)
          window.localStorage.setItem('INVENTORY', str_inventory)
        }

  
    </script>

    <style>
      
      body {
        font-family:'SanFrancisco';
      }
      /* Remove the jumbotron's default bottom margin */ 
      .jumbotron {
        margin-bottom: 0;
      }
    
      /* Add a gray background color and some padding to the footer */
      footer {
        background-color: #f2f2f2;
        padding: 25px;
      }

      .border-rad {
        border-radius: 20px
      }

      .this-button .btn-default {
        background-color: peachpuff;
        border: 1px solid black;
      }
      
      .float-child {
        float: left;
        text-align: left;
      }

      .wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .btn-primary {
        background-color:lightsteelblue;
        color: black;
      }

    </style>

  </head>

  <body class ="text-center" onload = "sort_order(); update();">

        <a href="inventory.html">
          <div class="this-button"><button class="btn-default float-child rounded m-2">Back to Inventory</button></div>   
        </a>
      
        <br> 

        <div class='container'> <h1 class="text-center" style="font-size: 4vw; color:lightsteelblue;clear:left"> Inventory List </h1> </div>
    

        

        <form class = "container" onsubmit="return add(); return update()">
          <button type = "submit" class="btn-primary btn">Add New Item</button> <br></br> 
          <label for="item">Item:</label>
          <input type="text" id="item" name="item" placeholder = "ex. Chicken" required>
          <label for="qty">Quantity:</label>
          <input type="text" id="qty" name="qty" placeholder = "ex. 2 lbs" required>
          <label for="expdate">Expiration Date:</label>
          <input type="text" id="expdate" name="expdate" placeholder = MM-DD-YYYY required>

      
          <a class="btn btn-sm dropdown-toggle flex-grow-1" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
            Food Group
          </a>
          
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink" id="demolist">
            <li><a class="dropdown-item" href="#">Proteins</a></li>
            <li><a class="dropdown-item" href="#">Vegetables</a></li>
            <li><a class="dropdown-item" href="#">Fruits</a></li>
            <li><a class="dropdown-item" href="#">Grains</a></li>
            <li><a class="dropdown-item" href="#">Other</a></li>
          </ul>

          
        </form>

        <br> </br>
        <div class="col-sm-2 sidenav">
          <!-- <div class="button-container">
            <div class="button-center">
              <button type="button" class="btn btn-secondary"><i class="fas fa-plus"></i></button>
            </div>
          </div> -->
          <div class="dropdown">
            <a class="btn btn-secondary dropdown-toggle flex-grow-1" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
              Sort By
            </a>
            
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
              <li><a class="dropdown-item" href="#" onclick = "sort_by_date_soonest();">Expiring (Soonest First)</a></li>
              <li><a class="dropdown-item" href="#" onclick = "sort_by_date_latest();">Expiring (Latest First)</a></li>
              <li><a class="dropdown-item" href="#" onclick = "sort_table_alphabet();">A-Z</a></li>
              <li><a class="dropdown-item" href="#" onclick = "sort_table_rev();">Z-A</a></li>
              <li><a class="dropdown-item" href="#" onclick = "sort_by_qty_high();">Quantity (Highest First)</a></li>
              <li><a class="dropdown-item" href="#" onclick = "sort_by_qty_low();">Quantity (Lowest First)</a></li>
            </ul>
          </div>
        </div>
        <br> </br>
        <table class="table" id="food">
          <thead>
            <tr>
              <th scope="col">Item</th>
              <th scope="col">Quantity</th>
              <th scope="col">Expiration Date</th>
              <th scope="col">Food Group</th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>     
  </body>

  <nav class="navbar fixed-bottom nav-fill navbar-expand-sm navbar-dark bg-light border-top">
    <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../index.html"> <i class="fas fa-home"></i> Home </a>
    <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../groceries/groceries.html"> <i class="fas fa-list-alt"></i> Grocery Lists </a>
    <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../inventory/inventory.html"> <i class="fas fa-shopping-basket"></i> Inventory </a>
    <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../recipes/recipe.html"> <i class="fas fa-book"></i> Recipes </a>
    <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../settings.html"> <i class="fas fa-wrench"></i> Settings</a>
  </nav>

</html>