<!doctype html>
<html>
    <head>
      <title>Inventory</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css">
      <link rel="stylesheet" href="./../index.css">
      <link rel="stylesheet" href="../../bootstrap-table-master/dist/bootstrap-table.min.css">
      <link href="../../fontawesome/css/all.css" rel="stylesheet">
      <script type = "text/javascript" src="../../bootstrap/js/jquery-3.6.0.min.js"></script>
      <script type = "text/javascript" src="../../bootstrap/js/bootstrap.bundle.min.js"></script>
      <script type = "text/javascript" src="../../bootstrap-table-master/dist/bootstrap-table.min.js"></script>
      
      <script>
        function update() {
            // init if localStorage variable does not exist
            let curr = window.localStorage.getItem('INVENTORY')
            if (curr == null) {
                window.localStorage.setItem('INVENTORY', JSON.stringify({ items: [] }))
            } else {
                $("#food tbody tr").remove() 
                let inventory = JSON.parse(curr)
                inventory.items.forEach(el => {
                  $("#food tbody").append("<tr>" +
                  "<td>" + el['name'] + "</td>" +
                  "<td>" + el['qty'] + "</td>" +
                  "<td>" + el['expdate'] + "</td>" +
                  "<td>" + el['category'] + "</td>" +
                  "<td onclick=\"del(this, '" + el['name'] + "');\"><i class='fas fa-trash'></i></td>" + 
                  "</tr>");
                  })
            }
        }
    </script>
    <script>

        $(document).ready(function () {
          $('#demolist a').on('click', function () {
            $('#dropdownMenuLink').html($(this).text() + ' <span class="caret"></span>');
            $('#dropdownMenuLink').val($(this).data('value'));
          });
        });

        function add() {
            // init if localStorage variable does not exist
            let curr = window.localStorage.getItem('INVENTORY')
            if (curr == null) {
                window.localStorage.setItem('INVENTORY', JSON.stringify({ items: [] }))
            }
            
            let inventory = JSON.parse(window.localStorage.getItem('INVENTORY'))

            item = document.getElementById("item").value
            qty = document.getElementById("qty").value
            expdate = document.getElementById("expdate").value
            category = document.getElementById("dropdownMenuLink").text



            entry = {}
            entry["name"] = item
            entry["qty"] = qty
            entry["expdate"] = expdate
            entry['category'] = category 
            
            console.log(inventory)

            if (!(entry in inventory['items'])) {
              inventory['items'].push(entry)
            }

            str_inventory = JSON.stringify(inventory)
            window.localStorage.setItem('INVENTORY', str_inventory)
        }

        function openGroceryList(uuid) {
            window.location.href = "./grocery-list.html" + `?uuid=${uuid}`; 
        }

        function del(o, name) { 
          let inventory = JSON.parse(window.localStorage.getItem('INVENTORY'))
          
          o.parentNode.remove() 

          inventory['items'] = inventory.items.filter(el => {
              return (el['name'] != name)
          })
          
          str_inventory = JSON.stringify(inventory)
          window.localStorage.setItem('INVENTORY', str_inventory)
        }

  
    </script>

    <style>
      
      body {
        font-family:'SanFrancisco';
      }
      /* Remove the jumbotron's default bottom margin */ 
      .jumbotron {
        margin-bottom: 0;
      }
    
      /* Add a gray background color and some padding to the footer */
      footer {
        background-color: #f2f2f2;
        padding: 25px;
      }

      .border-rad {
        border-radius: 20px
      }

      .this-button .btn-default {
        background-color: peachpuff;
        border: 1px solid black;
      }
      
      .float-child {
        float: left;
        text-align: left;
      }

      .wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .btn-primary {
        background-color:lightsteelblue;
        color: black;
      }

    </style>

  </head>

  <body class ="container-fluid" onload = "update();">

        <a href="inventory.html">
          <div class="this-button"><button class="btn-default float-child rounded m-2">Back to Inventory</button></div>   
        </a>
        
        <br> 

        <div class ="wrapper"> <button class="btn-primary btn" onclick="add(); update()">Add New Item</button> <br></br><br></br> </div>

        <form>
          
          <label for="item">Item:</label>
          <input type="text" id="item" name="item">
          <label for="qty">Quantity (Include units):</label>
          <input type="text" id="qty" name="qty">
          <label for="expdate">Expiration Date:</label>
          <input type="text" id="expdate" name="expdate">

      
          <a class="btn btn-sm dropdown-toggle flex-grow-1" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
            Food Category
          </a>
          
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink" id="demolist">
            <li><a class="dropdown-item" href="#">Proteins</a></li>
            <li><a class="dropdown-item" href="#">Vegetables</a></li>
            <li><a class="dropdown-item" href="#">Fruits</a></li>
            <li><a class="dropdown-item" href="#">Grains</a></li>
            <li><a class="dropdown-item" href="#">Other</a></li>
          </ul>

          
        </form>

        <br> </br>
        <div class="col-sm-2 sidenav">
          <!-- <div class="button-container">
            <div class="button-center">
              <button type="button" class="btn btn-secondary"><i class="fas fa-plus"></i></button>
            </div>
          </div> -->
          <div class="dropdown">
            <a class="btn btn-secondary dropdown-toggle flex-grow-1" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
              Sort By
            </a>
            
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
              <li><a class="dropdown-item" href="#">Expiration Date</a></li>
              <li><a class="dropdown-item" href="#">Quantity</a></li>
              <li><a class="dropdown-item" href="#">A-Z</a></li>
            </ul>
          </div>
        </div>
        <br> </br>
        <table class="table" id="food">
          <thead>
            <tr>
              <th scope="col">Item</th>
              <th scope="col">Quantity</th>
              <th scope="col">Expiration Date</th>
              <th scope="col">Food Group</th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      
      
  </body>

  <nav class="navbar fixed-bottom nav-fill navbar-expand-sm navbar-dark bg-light border-top">
    <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../index.html"> <i class="fas fa-home"></i> Home </a>
    <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../groceries/groceries.html"> <i class="fas fa-list-alt"></i> Grocery Lists </a>
    <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../inventory/inventory.html"> <i class="fas fa-shopping-basket"></i> Inventory </a>
    <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../recipes/recipe.html"> <i class="fas fa-book"></i> Recipes </a>
    <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../settings.html"> <i class="fas fa-wrench"></i> Settings</a>
  </nav>

</html>