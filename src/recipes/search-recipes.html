<html>
    <head>
        <title> Search Recipes Page </title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script type="text/javascript" src="../../bootstrap/js/jquery-3.6.0.min.js"></script>
        <link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="../index.css">
        <link href="../../fontawesome/css/all.css" rel="stylesheet">
        <script>
            window.onload = function() { 
                var x = document.getElementById("results");
                x.style.display = "none"; 
            }

            function getSearch() {
                document.getElementById("results").innerHTML = "";
                var nameField = document.getElementById('recipeName').value.toLowerCase();
                var cookingTime = document.getElementById("cookingTime").value;
                var dietary = document.getElementById("restrictions").value;
                cards = ['FIXED_RECIPE_CARDS', 'RECIPE_CARDS'];
                for (var i = 0; i < cards.length; i++) {
                    curr = window.localStorage.getItem(cards[i])
                    if (curr != null) {
                        let recipeCards = JSON.parse(curr)
                        recipeCards.items.forEach(
                            function(el) {
                                totalTime = parseInt(el.prep) + parseInt(el.cooking);
                                if (el.name.toLowerCase().includes(nameField) || totalTime <= cookingTime || (cookingTime == "1hr" && totalTime >= 60 && totalTime <= 90) 
                                || (cookingTime == "plus" && totalTime > 90) || el.dietary.toLowerCase() == dietary) {
                                    $("#results").append("<button class=\"cardButton\" style=\"border: 2px solid white; background-color: white;\"" + 
                                        "onclick=\"showRecipe('" + el.name + "','" + el.recipeImage + "','" + el.prep + "','" + el.cooking + "','" + el.category + "','" + el.ingredients + "')\">" + 
                                        "<div class=\"card col-lg-12 m-2\">" + 
                                        "<img class=\"card-img-top\" src=" + el.recipeImage + ">" + 
                                        "<div class=\"card-body\">" +
                                            "<h5 class=\"card-title text-wrap\">" + el.name + "</h5>" +     
                                        "</div> </div></button>"
                                    );      
                                }  
                        })
                    } 
                }
                var y = document.getElementById("results");
                y.style.display = "block";
            }

             function revealOrHideCard(card_id, state) {
                var x = document.getElementById(card_id);
                x.style.display = state;
             }

            function showCategory(category) {
                document.getElementById("results").innerHTML = "";
                cards = ['FIXED_RECIPE_CARDS', 'RECIPE_CARDS'];
                for (var i = 0; i < cards.length; i++) {
                    curr = window.localStorage.getItem(cards[i])
                    if (curr != null) {
                        let recipeCards = JSON.parse(curr)
                        recipeCards.items.forEach(
                            function(el) {
                                if (el.category === category || category == "all") {
                                $("#results").append("<button class=\"cardButton\" style=\"border: 2px solid white; background-color: white;\"" + 
                                    "onclick=\"showRecipe('" + el.name + "','" + el.recipeImage + "','" + el.prep + "','" + el.cooking + "','" + el.category + "','" + el.dietary + "','" + el.ingredients + "')\">" + 
                                    "<div class=\"card col-lg-12 m-2\">" + 
                                    "<img class=\"card-img-top\" src=" + el.recipeImage + ">" + 
                                    "<div class=\"card-body\">" +
                                        "<h5 class=\"card-title text-wrap\">" + el.name + "</h5>" +     
                                    "</div> </div></button>"
                                );  
                            }  
                        })
                    } 
                }
                var y = document.getElementById("results");
                y.style.display = "block";
            }

            function showRecipe(name, image, prep, cooking, category, dietary, ingred) {
                closeCard();
                document.getElementById("recipeTitle").innerHTML = name;
                var img = document.createElement("img");
                img.src = image;
                var src = document.getElementById("recipeImg");
                src.appendChild(img);
                document.getElementById("dietary").innerHTML = "Dietary Restriction: " + dietary;

                thisList = ["<b> Ingredients </b>"];
                var list = document.getElementById("ingredients");
                var ingredients = ingred.split(",")
                for (var i = 0; i < ingredients.length; i++) {
                    thisList.push("<li>" + ingredients[i] + "</li>");
                }
                list.innerHTML = thisList.join('');
                
                total = parseInt(prep) + parseInt(cooking);
                document.getElementById("time").innerHTML = 
                    "<b> Prep Time: </b>" + prep + " mins" + "<br>" + "<b> Cooking Time: </b> " + 
                    cooking + " mins" + "<br>" + "<b> Total Time: </b>" + total + " mins";

                var x = document.getElementById("fullCard");
                x.style.display = "block";
            };

            function closeCard() {
                var x = document.getElementById("fullCard");
                x.style.display = "none";
                document.getElementById("recipeImg").innerHTML = "";
            }
        </script>
        <style>
        .recipe-cards .card {
            width: 12vw;
            height: 31vh;
            float:left;
            border:1px solid darkgray;
            box-shadow: 0 3px 5px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }
        .recipe-cards .card-title {
            font-size:1.2vw;
            color:black;
        }
        .recipe-cards .card .btn {
            background-color:lightsteelblue;
            border:1px solid darkgray;
            font-size: 0.8vw;
        } 

        .categories .card {
            width:12vw;
            height:25vh;
            box-shadow: 0 3px 5px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            display: inline-flex;
            border: 1px solid black;
            margin: 1px;
            justify-content: center;
            color:black;
        }

        .color1 { background-color: lightsteelblue; }
        .color2 { background-color: paleturquoise; }
        .color3 { background-color: peachpuff; }
        .float-child { float: left; }

        .this-button .btn-default {
            background-color: peachpuff;
            border: 1px solid black;
        }

        .scrollmenu {
            overflow: auto;
            white-space: nowrap;
        }

        ::-webkit-scrollbar { height: 10px; }
        .scrollmenu::-webkit-scrollbar { background-color: #F5F5F5; }

        .scrollmenu::-webkit-scrollbar-thumb {
        border-radius: 10px;
        border: 1px solid lightgray;
        background-color: #f8f8f8;
        }

        .cards button {
            border: 2px solid white;
            background-color: white;
        }

        </style>
    </head>
    <body class="text-center">
        <!-- Return to Recipes -->
        <a href="recipe.html">
        <div class="this-button"><button class="btn-default float-child rounded m-2">Back to Recipes</button></div>
        </a>
        <div class="container pb-2" style="clear:both; color:lightsteelblue"><h1>Search Recipes</h1></div>
        
        <!-- Search and Filters -->
        <div class="container d-flex justify-content-between">
            <div class="input-group rounded" style="min-width: 30vw;">
                <input type="search" class="form-control rounded" id="recipeName"  autocomplete="off" placeholder="Search by Name" aria-label="Search"
                  aria-describedby="search-addon"/>
                <!-- <div class="m-3 ms-5"> or </div> -->
            </div>
            <!-- <div class="justify-content-between"> or </div> -->
            <select class="form-select d-flex ms-5 float-child" style="width:650px" id="cookingTime">
                <option selected value="0">Cooking Time</option>
                <option value="10">10 min or less</option>
                <option value="20">20 min or less</option>
                <option value="30">30 min or less</option>
                <option value="40">40 min or less</option>
                <option value="50">50 min or less</option>
                <option value="1hr">1-1.5 hours</option>
                <option value="plus">> 1.5 hours</option>
            </select>
            <select class="form-select d-flex ms-5 float-child" style="width:650px" id="restrictions">
                <option selected value="0">Dietary Restrictions</option>
                <option value="Gluten-Free">Gluten-Free</option>
                <option value="Peanut-Free">Peanut-Free</option>
                <option value="Vegetarian">Vegetarian</option>
                <option value="Vegan">Vegan</option>
            </select>
            <div class="this-button"><button class="btn-default ms-5 float-child rounded p-2" onclick="getSearch()" style="width: 100px">Search</button></div>
            <div class="this-button"><button class="btn-default ms-5 float-child rounded p-2" onclick="showCategory('all')" style= "width:100px">Show All</button></div>
        </div>


        <!-- Individual Recipe Card -->
        <div class="recipe-cards">
        <h5 class="ms-4 mt-4" style="text-align:left">Most Relevant Results</h5>
        <div class="float-child ms-4 mt-4" id="results"></div>

        <!-- Recipe Category Cards -->
        <div class="categories" style="clear:both;margin-top:15%;"> 
                <h2>Categories</h2>
                <div class="carousel slide col-lg-12" data-bs-touch="false" data-bs-interval="false">
                    <div class="scrollmenu carousel-inner active col-lg-3 text-center">
                        <div class="carousel-item active">
                            <div class="cards">
                                <button onclick="showCategory('Mexican')">
                                    <div class="card col-lg-12 m-2 color1"><h3 class="card-title text-justify">Mexican</h3></div>
                                </button>
                                <button onclick="showCategory('Asian')">
                                    <div class="card col-lg-12 m-2 color2"><h3 class="card-title text-justify">Asian</h3></div>
                                </button>
                                <button onclick="showCategory('Breakfast')">
                                    <div class="card col-lg-12 m-2 color3"><h3 class="card-title text-justify">Breakfast</h3></div>
                                </button>
                                <button onclick="showCategory('Burgers')">
                                    <div class="card col-lg-12 m-2 color1"><h3 class="card-title text-justify">Burgers</h3></div>
                                </button>
                                <button onclick="showCategory('Chicken')">
                                    <div class="card col-lg-12 m-2 color2"><h3 class="card-title text-justify">Chicken</h3></div>
                                </button>
                                <button onclick="showCategory('Desserts')">
                                    <div class="card col-lg-12 m-2 color3"><h3 class="card-title text-justify">Desserts</h3></div>
                                </button>
                                <button onclick="showCategory('Drinks')">
                                    <div class="card col-lg-12 m-2 color1"><h3 class="card-title text-justify">Drinks</h3></div>
                                </button>
                                <button onclick="showCategory('Indian')">
                                    <div class="card col-lg-12 m-2 color2"><h3 class="card-title text-justify">Indian</h3></div>
                                </button>
                                <button onclick="showCategory('Greek')">
                                    <div class="card col-lg-12 m-2 color3"><h3 class="card-title text-justify">Greek</h3></div>
                                </button>
                                <button onclick="showCategory('Salads')">
                                    <div class="card col-lg-12 m-2 color1"><h3 class="card-title text-justify">Salads</h3></div>
                                </button>
                                <button onclick="showCategory('Seafood')">
                                    <div class="card col-lg-12 m-2 color2"><h3 class="card-title text-justify">Seafood</h3></div>
                                </button>
                                <button onclick="showCategory('Soups')">
                                    <div class="card col-lg-12 m-2 color3"><h3 class="card-title text-justify">Soups</h3></div>
                                </button>
                            </div>
                    </div>
                </div>
         </div>
         </div>
        
         
        <!-- Nav Bar -->
        <nav class="navbar fixed-bottom nav-fill navbar-expand-sm navbar-dark bg-light border-top">
            <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../index.html"> <i class="fas fa-home"></i> Home </a>
            <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../groceries/groceries.html"> <i class="fas fa-list-alt"></i> Grocery Lists </a>
            <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../inventory/inventory.html"> <i class="fas fa-shopping-basket"></i> Inventory </a>
            <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../recipes/recipe.html"> <i class="fas fa-book"></i> Recipes </a>
            <a class="btn btn-default flex-grow-1" id="settings" name="settings" style = "font-family:SanFrancisco" href = "../settings.html"> <i class="fas fa-wrench"></i> Settings</a>
        </nav>
    
    </body>
    
</html>